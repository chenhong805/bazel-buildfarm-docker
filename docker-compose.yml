version: "2"

services:
  buildfarm_redis:
    image: redis:latest
    restart: always
    network_mode: "host"
    #ports:
    #  - 6379:6379
  server:
    build:
      context: .
    command: 'bazel run //src/main/java/build/buildfarm:buildfarm-server -- --jvm_flag=-Djava.util.logging.config.file=/app/bazel-buildfarm/examples/logging.properties /app/bazel-buildfarm/examples/config.minimal.yml'
    volumes:
      - ./config:/config
    network_mode: "host"
    #ports:
    #  - 8980:8980
    depends_on:
      - buildfarm_redis

  worker:
    # entrypoint: "/app/buildfarm-operationqueue-worker /config/worker.config"
    command: 'bazel run //src/main/java/build/buildfarm:buildfarm-shard-worker -- --jvm_flag=-Djava.util.logging.config.file=/app/bazel-buildfarm/examples/logging.properties /app/bazel-buildfarm/examples/config.minimal.yml'
    build:
      context: .
    volumes:
      - ./config:/config
    network_mode: "host"
    depends_on:
      - server
